<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Dashboard - UltimateBrain.io</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .dashboard-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #2552a3;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 1.1em;
        }
        
        .progress-section {
            background-color: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .progress-chart {
            height: 300px;
            background-color: white;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .supplement-tracker {
            background-color: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .supplement-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .supplement-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
        }
        
        .supplement-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        
        .save-btn {
            background-color: #2552a3;
            color: white;
            padding: 10px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .save-btn:hover {
            background-color: #1e4285;
        }
        
        .no-data {
            text-align: center;
            padding: 60px;
            color: #999;
        }
        
        .session-log {
            max-height: 400px;
            overflow-y: auto;
            background-color: white;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 20px;
        }
        
        .session-entry {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .session-entry:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <a href="/" class="domain-name">
            <img src="favicon.svg" alt="UltimateBrain.io Logo" class="logo-icon">
            UltimateBrain.io
        </a>
        <a href="/" class="study-link">Back to Training</a>
    </div>

    <div id="game-container">
        <h1>Your Study Dashboard</h1>
        <p class="tagline">Track your cognitive enhancement progress</p>
        
        <div class="dashboard-container" id="dashboard-content">
            <!-- Content will be dynamically generated -->
        </div>
    </div>

    <script>
        // Check if enrolled
        const enrolled = localStorage.getItem('studyEnrolled');
        const userData = JSON.parse(localStorage.getItem('studyUserData') || '{}');
        
        if (!enrolled || !userData.participantId) {
            document.getElementById('dashboard-content').innerHTML = `
                <div class="no-data">
                    <h2>Not Enrolled</h2>
                    <p>You need to enroll in the study to access your dashboard.</p>
                    <a href="study-enrollment.html" class="save-btn" style="display: inline-block; text-decoration: none;">Enroll Now</a>
                </div>
            `;
        } else {
            displayDashboard();
        }
        
        function displayDashboard() {
            const sessions = userData.studyData.sessions || [];
            const supplements = userData.studyData.supplements || [];
            
            // Calculate statistics
            const totalSessions = sessions.length;
            const avgScore = sessions.reduce((sum, s) => sum + (s.totalScore || 0), 0) / (totalSessions || 1);
            const highestLevel = Math.max(...sessions.map(s => s.nBackLevel || 2), 2);
            const totalTime = sessions.reduce((sum, s) => sum + (s.duration || 0), 0) / 60000; // Convert to minutes
            
            const dashboardHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Sessions</div>
                        <div class="stat-value">${totalSessions}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Score</div>
                        <div class="stat-value">${Math.round(avgScore)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Highest N-Back</div>
                        <div class="stat-value">${highestLevel}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Time</div>
                        <div class="stat-value">${Math.round(totalTime)}m</div>
                    </div>
                </div>
                
                <div class="supplement-tracker">
                    <h2>Track Your Supplements & Techniques</h2>
                    <p>Select what you're currently using to enhance your training:</p>
                    <div class="supplement-list">
                        <div class="supplement-item">
                            <input type="checkbox" id="creatine" ${supplements.includes('creatine') ? 'checked' : ''}>
                            <label for="creatine">Creatine</label>
                        </div>
                        <div class="supplement-item">
                            <input type="checkbox" id="choline" ${supplements.includes('choline') ? 'checked' : ''}>
                            <label for="choline">Choline</label>
                        </div>
                        <div class="supplement-item">
                            <input type="checkbox" id="lions-mane" ${supplements.includes('lions-mane') ? 'checked' : ''}>
                            <label for="lions-mane">Lion's Mane</label>
                        </div>
                        <div class="supplement-item">
                            <input type="checkbox" id="breathing" ${supplements.includes('breathing') ? 'checked' : ''}>
                            <label for="breathing">Breathing Exercises</label>
                        </div>
                        <div class="supplement-item">
                            <input type="checkbox" id="meditation" ${supplements.includes('meditation') ? 'checked' : ''}>
                            <label for="meditation">Meditation</label>
                        </div>
                        <div class="supplement-item">
                            <input type="checkbox" id="other" ${supplements.includes('other') ? 'checked' : ''}>
                            <label for="other">Other Supplements</label>
                        </div>
                    </div>
                    <button class="save-btn" onclick="saveSupplements()">Save Supplements</button>
                </div>
                
                <div class="progress-section">
                    <h2>Recent Sessions</h2>
                    <div class="session-log">
                        ${sessions.length === 0 ? '<p class="no-data">No sessions recorded yet. Start training to see your progress!</p>' : 
                          sessions.slice(-10).reverse().map(session => `
                            <div class="session-entry">
                                <strong>${new Date(session.date).toLocaleDateString()}</strong> - 
                                Level ${session.nBackLevel || 2} | 
                                Score: ${session.totalScore || 0} | 
                                Position: ${session.positionCorrect || 0}/${session.positionTotal || 0} | 
                                Letter: ${session.letterCorrect || 0}/${session.letterTotal || 0}
                            </div>
                          `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('dashboard-content').innerHTML = dashboardHTML;
        }
        
        function saveSupplements() {
            const checkboxes = document.querySelectorAll('.supplement-item input[type="checkbox"]');
            const supplements = [];
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    supplements.push(checkbox.id);
                }
            });
            
            userData.studyData.supplements = supplements;
            localStorage.setItem('studyUserData', JSON.stringify(userData));
            
            alert('Supplements saved successfully!');
        }
    </script>
</body>
</html>